// src/i18n.js
import React, { createContext, useContext, useMemo, useEffect, useState } from 'react';

const TRANSLATIONS = {
  pl: {
    app: {
      title: 'Realtime Barcode & QR Studio',
      tabs: { generator: 'Generator', batch: 'Batch', labels: 'Etykiety' },
      lang: 'J\u0119zyk',
    },
    generator: {
      dataToEncode: 'Dane do zakodowania',
      chars: 'Znaki',
      codeType: 'Typ kodu',
      scale: 'Skala',
      moduleWidth: 'Grubo\u015b\u0107 modu\u0142u (px)',
      height1d: 'Wysoko\u015b\u0107 (1D)',
      hrtText: 'Tekst pod kodem (HRT)',
      hrtFont: 'Czcionka HRT',
      hrtSize: 'Rozmiar HRT',
      hrtGap: 'Odst\u0119p HRT',
      customCaption: 'Niestandardowy podpis',
      customCaptionText: 'Tekst podpisu',
      customCaptionFont: 'Czcionka podpisu',
      customCaptionSize: 'Rozmiar podpisu',
      customCaptionGap: 'Odst\u0119p podpisu',
      rotate: 'Obr\u00f3t (kod)',
      addToSheet: 'Dodaj do arkusza',
      preview: 'Podgl\u0105d',
      pngTimes: 'PNG x',
      downloadPng: 'Pobierz PNG',
      downloadSvg: 'Pobierz SVG',
      emptyHint: 'Upewnij si\u0119, \u017ce dane spe\u0142niaj\u0105 wymagania standardu.',
      errorNoText: 'Brak danych - wpisz tekst (URL/GS1)',
      kind2D: '2D',
      kind1D: '1D',
      noPreview: 'Brak podgl\u0105du',
      placeholder2d: 'Tekst/URL/GS1 (np. (01)(10) ...)',
      placeholder1d: 'Ci\u0105g zgodny ze standardem',
      heightBars: 'S\u0142upki w px',
      whiteBackground: 'Bia\u0142e t\u0142o',
    },
    batch: {
      title: 'Batch - wklej list\u0119 lub wczytaj CSV',
      titleShort: 'Batch',
      panelBatch: 'Batch',
      panelSequence: 'Generator sekwencji',
      codeType: 'Typ kodu',
      dropHint: 'Przeci\u0105gnij i upu\u015b\u0107 plik CSV/TXT lub kliknij, aby wybra\u0107',
      dropSubhint: '1 linia w TXT = 1 rekord',
      helpLinePerRow: 'Ka\u017cdy wiersz to jeden kod',
      generateList: 'Generuj list\u0119',
      clearList: 'Wyczy\u015b\u0107 list\u0119',
      clickToAddOne: 'Kliknij, aby doda\u0107 pojedynczo',
      addLabel: 'Dodaj etykiet\u0119',
      addToSheet: 'Dodaj do arkusza',
      addedOne: 'Dodano 1 etykiet\u0119',
      results: 'Wyniki ({count})',
      segmentValue: 'Warto\u015b\u0107',
      segmentMode: 'Tryb',
      segmentModeStatic: 'Sta\u0142a',
      segmentModeInc: 'Inkrementacja',
      segmentModeDec: 'Dekrementacja',
      segmentModeRandom: 'Losowo',
      segmentStep: 'Krok',
      segmentPad: 'Pad',
      segmentMin: 'Min',
      segmentMax: 'Max',
      removeField: 'Usu\u0144',
      addField: 'Dodaj pole',
      sequenceCount: 'Ilo\u015b\u0107 kod\u00f3w',
      errorCsv: 'B\u0142\u0105d CSV',
      errorTxt: 'B\u0142\u0105d TXT',
      errorUnsupported: 'Nieobs\u0142ugiwany plik',
    },
    codes: {
      qrcode: { label: 'QR Code', note: 'Tekst/URL/GS1. Dobra korekcja b\u0142\u0119d\u00f3w.' },
      datamatrix: { label: 'Data Matrix', note: 'Ma\u0142e etykiety, GS1.' },
      pdf417: { label: 'PDF417', note: 'Du\u017co danych, boarding pass.' },
      azteccode: { label: 'Aztec', note: 'Bilety/transport.' },
      code128: { label: 'Code 128', note: 'Pe\u0142ne ASCII. Uniwersalny (GS1-128).' },
      ean13: { label: 'EAN-13', note: '12-13 cyfr (ostatnia kontrolna).' },
      ean8: { label: 'EAN-8', note: '7-8 cyfr (ostatnia kontrolna).' },
      itf14: { label: 'ITF-14', note: '13-14 cyfr (opakowania zbiorcze).' },
      gs1_128: { label: 'GS1-128', note: 'U\u017cyj (AI) w nawiasach, np. (01)(10).' },
    },
    labels: {
      preset: 'Preset',
      pageSize: 'Strona (mm) - szer. x wys.',
      gridColsRows: 'Siatka - kol. x wiersze',
      hideSettings: 'Ukryj ustawienia',
      showSettings: 'Pokaż ustawienia',
      settingsHidden: 'Ustawienia zwinięte',
      sheetCode: 'Kod (arkusz)',
      changeAllCodes: 'Zmie\u0144 wszystkie',
      selectLabelOrAll: 'Wybierz etykiet\u0119 lub zaznacz "Zmie\u0144 wszystkie"',
      gridTitle: 'Etykiety',
      margins: 'Margines (mm)',
      gutter: 'Odst\u0119p (mm)',
      skip: 'Pomi\u0144 etykiety (skip)',
      scaleX: 'Skalowanie etykiet (x strona)',
      rotateOnSheet: 'Obr\u00f3t na stronie',
      showGrid: 'Poka\u017c linie siatki',
      editMode: 'Tryb edycji',
      freeLayout: 'Free layout (dowolne po\u0142o\u017cenie)',
      snap: 'Snap (mm)',
      posMM: 'Pozycja (mm)',
      moveAll: 'Przesu\u0144 WSZYSTKIE o (mm)',
      x: 'X',
      y: 'Y',
      dX: 'dX',
      dY: 'dY',
      editAll: 'Edytuj wszystkie',
      lockAspect: 'Zablokuj proporcje',
      widthShort: 'Szer.',
      heightShort: 'Wys.',
      count: 'Etykiet',
      perPage: 'Na stron\u0119',
      pages: 'Stron',
      zoom: 'Zoom',
      print: 'Drukuj',
      exportPdf: 'Eksport PDF',
      reset: 'Reset ustawie\u0144',
      clearLabels: 'Wyczy\u015b\u0107 etykiety',
      alignLeft: 'Wyr\u00f3wnaj do lewej',
      alignCenterH: 'Wyr\u00f3wnaj do \u015brodka',
      alignRight: 'Wyr\u00f3wnaj do prawej',
      distributeH: 'Roz\u0142\u00f3\u017c r\u00f3wno w poziomie',
      alignTop: 'Wyr\u00f3wnaj do g\u00f3ry',
      centerV: 'Wy\u015brodkuj pionowo',
      alignBottom: 'Wyr\u00f3wnaj do do\u0142u',
      distributeV: 'Roz\u0142\u00f3\u017c r\u00f3wno w pionie',
      centerH: 'Wy\u015brodkuj poziomo',
      centerHV: 'Wy\u015brodkuj (H+V)',
      scopeAll: 'Zakres: wszystkie ({count})',
      selectedCount: 'Zaznaczono: {count}',
      includeText: 'Podpis pod kodem',
      textDisabledInEditAll: 'Wy\u0142\u0105czone w trybie Edytuj wszystkie',
      codeContent: 'Zawarto\u015b\u0107 kodu',
      resetChanges: 'Reset zmian',
      clearSelection: 'Wyczy\u015b\u0107 zaznaczenie',
    },
    gs1: {
      verifyTitle: 'Weryfikacja GS1 (AI)',
      ok: 'OK - nie wykryto problem\u00f3w.',
    },
    errors: {
      fallback: 'Nieprawid\u0142owe dane dla wybranego standardu.',
      ean13badlength: 'EAN-13 musi mie\u0107 12 lub 13 cyfr',
      ean8badlength: 'EAN-8 musi mie\u0107 7 lub 8 cyfr',
      upcabadlength: 'UPC-A musi mie\u0107 11 lub 12 cyfr',
      upcebadlength: 'UPC-E musi mie\u0107 6, 7 lub 8 cyfr',
      itf14badlength: 'ITF-14 musi mie\u0107 13 lub 14 cyfr',
      code39badcharacter: 'Code 39 zawiera niedozwolony znak',
      code128badcharacter: 'Code 128 zawiera niedozwolony znak',
      itfbadcharacter: 'ITF (Interleaved 2 of 5) akceptuje tylko cyfry',
      badcheckdigit: 'Nieprawid\u0142owa cyfra kontrolna',
      badchecksum: 'Nieprawid\u0142owa suma kontrolna',
      toolong: 'Zbyt du\u017co danych',
    }
  },
  en: {
    app: {
      title: 'Realtime Barcode & QR Studio',
      tabs: { generator: 'Generator', batch: 'Batch', labels: 'Labels' },
      lang: 'Language',
    },
    generator: {
      dataToEncode: 'Data to encode',
      chars: 'Chars',
      codeType: 'Code type',
      scale: 'Scale',
      moduleWidth: 'Module width (px)',
      height1d: 'Height (1D)',
      hrtText: 'Human-readable text (HRT)',
      hrtFont: 'HRT font',
      hrtSize: 'HRT size',
      hrtGap: 'HRT gap',
      customCaption: 'Custom caption',
      customCaptionText: 'Caption text',
      customCaptionFont: 'Caption font',
      customCaptionSize: 'Caption size',
      customCaptionGap: 'Caption gap',
      rotate: 'Rotate (code)',
      addToSheet: 'Add to sheet',
      preview: 'Preview',
      pngTimes: 'PNG x',
      downloadPng: 'Download PNG',
      downloadSvg: 'Download SVG',
      emptyHint: 'Make sure your data matches the symbology rules.',
      errorNoText: 'No data - enter text (URL/GS1)',
      kind2D: '2D',
      kind1D: '1D',
      noPreview: 'No preview',
      placeholder2d: 'Text/URL/GS1 (e.g., (01)(10) ...)',
      placeholder1d: 'String matching the symbology rules',
      heightBars: 'Bars height (px)',
      whiteBackground: 'White background',
    },
    batch: {
      title: 'Batch - paste list or load CSV',
      titleShort: 'Batch',
      panelBatch: 'Batch',
      panelSequence: 'Sequence generator',
      codeType: 'Code type',
      dropHint: 'Drag and drop a CSV/TXT file or click to choose',
      dropSubhint: '1 TXT line = 1 record',
      helpLinePerRow: 'Each row is a single code',
      generateList: 'Generate list',
      clearList: 'Clear list',
      clickToAddOne: 'Click to add one',
      addLabel: 'Add label',
      addToSheet: 'Add to sheet',
      addedOne: 'Added 1 label',
      results: 'Results ({count})',
      segmentValue: 'Value',
      segmentMode: 'Mode',
      segmentModeStatic: 'Static',
      segmentModeInc: 'Increment',
      segmentModeDec: 'Decrement',
      segmentModeRandom: 'Random',
      segmentStep: 'Step',
      segmentPad: 'Pad',
      segmentMin: 'Min',
      segmentMax: 'Max',
      removeField: 'Remove',
      addField: 'Add field',
      sequenceCount: 'Count',
      errorCsv: 'CSV error',
      errorTxt: 'TXT error',
      errorUnsupported: 'Unsupported file',
    },
    codes: {
      qrcode: { label: 'QR Code', note: 'Text/URL/GS1. Strong error correction.' },
      datamatrix: { label: 'Data Matrix', note: 'Small labels, GS1.' },
      pdf417: { label: 'PDF417', note: 'Large payloads, boarding pass.' },
      azteccode: { label: 'Aztec', note: 'Tickets/transport.' },
      code128: { label: 'Code 128', note: 'Full ASCII. Universal (GS1-128).' },
      ean13: { label: 'EAN-13', note: '12-13 digits (last is check).' },
      ean8: { label: 'EAN-8', note: '7-8 digits (last is check).' },
      itf14: { label: 'ITF-14', note: '13-14 digits (case-level).' },
      gs1_128: { label: 'GS1-128', note: 'Use (AI) in parentheses, e.g., (01)(10).' },
    },
    labels: {
      preset: 'Preset',
      pageSize: 'Page (mm) - W x H',
      gridColsRows: 'Grid - cols x rows',
      hideSettings: 'Hide settings',
      showSettings: 'Show settings',
      settingsHidden: 'Settings collapsed',
      sheetCode: 'Code (sheet)',
      changeAllCodes: 'Change all',
      selectLabelOrAll: 'Select a label or check "Change all"',
      gridTitle: 'Labels',
      margins: 'Margins (mm)',
      gutter: 'Gutter (mm)',
      skip: 'Skip labels',
      scaleX: 'Label scaling (x page)',
      rotateOnSheet: 'Rotate on page',
      showGrid: 'Show grid lines',
      editMode: 'Edit mode',
      freeLayout: 'Free layout (any position)',
      snap: 'Snap (mm)',
      posMM: 'Position (mm)',
      moveAll: 'Move ALL by (mm)',
      x: 'X',
      y: 'Y',
      dX: 'dX',
      dY: 'dY',
      editAll: 'Edit all',
      lockAspect: 'Lock aspect',
      widthShort: 'W',
      heightShort: 'H',
      count: 'Labels',
      perPage: 'Per page',
      pages: 'Pages',
      zoom: 'Zoom',
      print: 'Print',
      exportPdf: 'Export PDF',
      reset: 'Reset settings',
      clearLabels: 'Clear labels',
      alignLeft: 'Align left',
      alignCenterH: 'Align center (H)',
      alignRight: 'Align right',
      distributeH: 'Distribute horizontally',
      alignTop: 'Align top',
      centerV: 'Center vertically',
      alignBottom: 'Align bottom',
      distributeV: 'Distribute vertically',
      centerH: 'Center horizontally',
      centerHV: 'Center (H+V)',
      scopeAll: 'Scope: all ({count})',
      selectedCount: 'Selected: {count}',
      includeText: 'Label text under code',
      textDisabledInEditAll: 'Disabled in Edit all mode',
      codeContent: 'Code content',
      resetChanges: 'Reset changes',
      clearSelection: 'Clear selection',
    },
    gs1: {
      verifyTitle: 'GS1 verification (AI)',
      ok: 'OK - no issues detected.',
    },
    errors: {
      fallback: 'Invalid data for the selected symbology.',
      ean13badlength: 'EAN-13 must be 12 or 13 digits',
      ean8badlength: 'EAN-8 must be 7 or 8 digits',
      upcabadlength: 'UPC-A must be 11 or 12 digits',
      upcebadlength: 'UPC-E must be 6, 7 or 8 digits',
      itf14badlength: 'ITF-14 must be 13 or 14 digits',
      code39badcharacter: 'Code 39 contains an invalid character',
      code128badcharacter: 'Code 128 contains an invalid character',
      itfbadcharacter: 'ITF (Interleaved 2 of 5) accepts digits only',
      badcheckdigit: 'Invalid check digit',
      badchecksum: 'Invalid checksum',
      toolong: 'Too much data',
    }
  }
};

const I18nCtx = createContext({ t:(k)=>k, lang:'pl', setLang:()=>{} });

export function I18nProvider({ children }){
  const [lang, setLang] = useState(()=>{
    try { return localStorage.getItem('rbs_lang') || 'pl'; } catch(_) { return 'pl'; }
  });
  useEffect(()=>{ try{ localStorage.setItem('rbs_lang', lang) }catch(_){ } }, [lang]);

  const t = useMemo(()=>{
    const dict = TRANSLATIONS[lang] || TRANSLATIONS.pl;
    return (key, vars={}) => {
      const segs = key.split('.');
      let cur = dict;
      for (const s of segs){ cur = cur?.[s]; if (cur==null) break; }
      let out = cur ?? key;
      if (typeof out === 'string'){
        Object.entries(vars).forEach(([k,v])=>{ out = out.replace(new RegExp('\\{'+k+'\\}','g'), String(v)); });
      }
      return out;
    };
  }, [lang]);

  const value = useMemo(()=>({ t, lang, setLang }), [t, lang]);
  return <I18nCtx.Provider value={value}>{children}</I18nCtx.Provider>;
}

export function useI18n(){ return useContext(I18nCtx); }
export const TRANSLATIONS_RAW = TRANSLATIONS;

