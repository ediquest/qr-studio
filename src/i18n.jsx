
import React, { createContext, useContext, useMemo, useEffect, useState } from 'react';

export const TRANSLATIONS = {
  pl: {
    app: {
      title: "Realtime Barcode & QR Studio",
      tabs: { generator: "Generator", batch: "Batch", labels: "Etykiety" },
      lang: "Język",
    },
    generator: {
      dataToEncode: "Dane do zakodowania",
      chars: "Znaki",
      codeType: "Typ kodu",
      scale: "Skala",
      moduleWidth: "Grubość modułu (px)",
      height1d: "Wysokość (1D)",
      hrtText: "Tekst pod kodem (HRT)",
      hrtFont: "Czcionka HRT",
      rotate: "Obrót (kod)",
      addToSheet: "Dodaj do arkusza",
      preview: "Podgląd",
      pngTimes: "PNG ×",
      downloadPng: "Pobierz PNG",
      downloadSvg: "Pobierz SVG",
      emptyHint: "Upewnij się, że dane spełniają wymagania standardu.",
      errorNoText: "Brak danych — wpisz tekst (URL/GS1)",
      kind2D: "2D",
      kind1D: "1D",
      noPreview: "Brak podglądu",
      placeholder2d: "Tekst/URL/GS1 (np. (01)(10) …)",
      placeholder1d: "Ciąg zgodny ze standardem",
      heightBars: "Słupki w px",
    },
    batch: {
      title: "Batch – wklej listę lub wczytaj CSV",
      helpLinePerRow: "Każdy wiersz to jeden kod",
      generateList: "Generuj listę",
      clearList: "Wyczyść listę",
      buildList: "Utwórz listę",
      clickToAddOne: "Kliknij, aby dodać pojedynczo",
      addLabel: "Dodaj etykietę",
      addSequenceToSheet: "Dodaj sekwencję do arkusza"
    },
    codes: {
      qrcode:  { label: "QR Code",   note: "Tekst/URL/GS1. Dobra korekcja błędów." },
      datamatrix:{ label: "Data Matrix", note:"Małe etykiety, GS1." },
      pdf417:  { label: "PDF417",    note: "Dużo danych, boarding pass." },
      azteccode: { label: "Aztec",   note: "Bilety/transport." },
      code128: { label: "Code 128",  note: "Pełne ASCII. Uniwersalny (GS1‑128)." },
      code39:  { label: "Code 39",   note: "A–Z 0–9 i - . $ / + % oraz spacja." },
      ean13:   { label: "EAN‑13",    note: "12–13 cyfr (ostatnia kontrolna)." },
      ean8:    { label: "EAN‑8",     note: "7–8 cyfr (ostatnia kontrolna)." },
      upca:    { label: "UPC‑A",     note: "11–12 cyfr (USA/retail)." },
      upce:    { label: "UPC‑E",     note: "6–8 cyfr (kompaktowy UPC)." },
      itf14:   { label: "ITF‑14",    note: "13–14 cyfr (opakowania zbiorcze)." },
      gs1_128: { label: "GS1‑128",   note: "Użyj (AI) w nawiasach, np. (01)(10)." },
          code93:  { label: "Code 93",   note: "Więcej znaków niż Code 39; ASCII przez pary." },
      code11:  { label: "Code 11",   note: "Cyfry i myślnik; telekomunikacja." },
      msi:  { label: "MSI",   note: "MSI/Plessey – detal/magazyn." },
      codabar:  { label: "Codabar",   note: "Cyfry + A–D; logistyka/laby." },
      interleaved2of5:  { label: "Interleaved 2 of 5",   note: "Parzysta liczba cyfr; logistyka." },
      standard2of5:  { label: "Standard 2 of 5",   note: "2 of 5; starszy format." },
      postnet:  { label: "POSTNET",   note: "USPS kody pocztowe." },
      planet:  { label: "PLANET",   note: "USPS tracking." },
      usps4cb:  { label: "Intelligent Mail",   note: "USPS 4‑CB (OneCode)." },
      rm4scc:  { label: "RM4SCC",   note: "Royal Mail / KIX 4‑state." },
      pharmacode:  { label: "Pharmacode",   note: "Jednotorowy kod farmaceutyczny." },
      pharmacode2:  { label: "Pharmacode 2‑track",   note: "Dwutorowy kod farmaceutyczny." },
      isbn:  { label: "ISBN",   note: "Książki; na bazie EAN‑13." },
      issn:  { label: "ISSN",   note: "Czasopisma; na bazie EAN‑13." },
      ismn:  { label: "ISMN",   note: "Druki muzyczne; na bazie EAN‑13." },
},
    labels: {
      gridTitle: "Etykiety",
      margins: "Margines (mm)",
      gutter: "Odstęp (mm)",
      skip: "Pomiń etykiety (skip)",
      scaleX: "Skalowanie etykiet (× strona)",
      rotateOnSheet: "Obrót na stronie",
      showGrid: "Pokaż linie siatki",
      editMode: "Tryb edycji",
      freeLayout: "Free layout (dowolne położenie)",
      snap: "Snap (mm)",
      posMM: "Pozycja (mm)",
      moveAll: "Przesuń WSZYSTKIE o (mm)",
      x: "X",
      y: "Y",
      dX: "ΔX",
      dY: "ΔY",
      editAll: "Edytuj wszystkie",
      lockAspect: "Zablokuj proporcje",
      widthShort: "Szer.",
      heightShort: "Wys.",
      count: "Etykiet",
      perPage: "Na stronę",
      pages: "Stron",
      zoom: "Zoom",
      print: "Drukuj",
      exportPdf: "Eksport PDF",
      reset: "Reset ustawień",
      clearLabels: "Wyczyść etykiety",
      alignLeft: "Wyrównaj do lewej",
      alignCenterH: "Wyrównaj do środka",
      alignRight: "Wyrównaj do prawej",
      distributeH: "Rozłóż równo w poziomie",
      alignTop: "Wyrównaj do góry",
      centerV: "Wyśrodkuj pionowo",
      alignBottom: "Wyrównaj do dołu",
      distributeV: "Rozłóż równo w pionie",
      centerH: "Wyśrodkuj poziomo",
      centerHV: "Wyśrodkuj (H+V)",
    },
    gs1: {
      verifyTitle: "Weryfikacja GS1 (AI)",
      ok: "OK – nie wykryto problemów.",
    },
    errors: {
      fallback: "Nieprawidłowe dane dla wybranego standardu.",
      ean13badlength: "EAN‑13 musi mieć 12 lub 13 cyfr",
      ean8badlength: "EAN‑8 musi mieć 7 lub 8 cyfr",
      upcabadlength: "UPC‑A musi mieć 11 lub 12 cyfr",
      upcebadlength: "UPC‑E musi mieć 6, 7 lub 8 cyfr",
      itf14badlength: "ITF‑14 musi mieć 13 lub 14 cyfr",
      code39badcharacter: "Code 39 zawiera niedozwolony znak",
      code128badcharacter: "Code 128 zawiera niedozwolony znak",
      itfbadcharacter: "ITF (Interleaved 2 of 5) akceptuje tylko cyfry",
      badcheckdigit: "Nieprawidłowa cyfra kontrolna",
      badchecksum: "Nieprawidłowa suma kontrolna",
      toolong: "Zbyt dużo danych",
    }
  },
  en: {
    app: {
      title: "Realtime Barcode & QR Studio",
      tabs: { generator: "Generator", batch: "Batch", labels: "Labels" },
      lang: "Language",
    },
    generator: {
      dataToEncode: "Data to encode",
      chars: "Chars",
      codeType: "Code type",
      scale: "Scale",
      moduleWidth: "Module width (px)",
      height1d: "Height (1D)",
      hrtText: "Human‑readable text (HRT)",
      hrtFont: "HRT font",
      rotate: "Rotate (code)",
      addToSheet: "Add to sheet",
      preview: "Preview",
      pngTimes: "PNG ×",
      downloadPng: "Download PNG",
      downloadSvg: "Download SVG",
      emptyHint: "Make sure your data matches the symbology rules.",
      errorNoText: "No data — enter text (URL/GS1)",
      kind2D: "2D",
      kind1D: "1D",
      noPreview: "No preview",
      placeholder2d: "Text/URL/GS1 (e.g., (01)(10) …)",
      placeholder1d: "String matching the symbology rules",
      heightBars: "Bars height (px)",
    },
    batch: {
      title: "Batch – paste list or load CSV",
      helpLinePerRow: "Each row is a single code",
      generateList: "Generate list",
      clearList: "Clear list",
      buildList: "Build list",
      clickToAddOne: "Click to add one",
      addLabel: "Add label",
      addSequenceToSheet: "Add sequence to sheet"
    },
    codes: {
      qrcode:  { label: "QR Code",   note: "Text/URL/GS1. Strong error correction." },
      datamatrix:{ label: "Data Matrix", note:"Small labels, GS1." },
      pdf417:  { label: "PDF417",    note: "Large data, boarding passes." },
      azteccode: { label: "Aztec",   note: "Tickets/transport." },
      code128: { label: "Code 128",  note: "Full ASCII. Universal (GS1‑128)." },
      code39:  { label: "Code 39",   note: "A–Z 0–9 and - . $ / + % and space." },
      ean13:   { label: "EAN‑13",    note: "12–13 digits (last is check)." },
      ean8:    { label: "EAN‑8",     note: "7–8 digits (last is check)." },
      upca:    { label: "UPC‑A",     note: "11–12 digits (US retail)." },
      upce:    { label: "UPC‑E",     note: "6–8 digits (compact UPC)." },
      itf14:   { label: "ITF‑14",    note: "13–14 digits (shipping cases)." },
      gs1_128: { label: "GS1‑128",   note: "Use (AI) in parentheses, e.g., (01)(10)." },
          code93:  { label: "Code 93",   note: "More symbols than Code 39; ASCII via pairs." },
      code11:  { label: "Code 11",   note: "Digits + dash; telecom." },
      msi:  { label: "MSI",   note: "MSI/Plessey — retail/warehouse." },
      codabar:  { label: "Codabar",   note: "Digits + A–D; logistics/labs." },
      interleaved2of5:  { label: "Interleaved 2 of 5",   note: "Even number of digits; logistics." },
      standard2of5:  { label: "Standard 2 of 5",   note: "Older 2 of 5 variant." },
      postnet:  { label: "POSTNET",   note: "USPS ZIP codes." },
      planet:  { label: "PLANET",   note: "USPS tracking." },
      usps4cb:  { label: "Intelligent Mail",   note: "USPS 4‑CB (OneCode)." },
      rm4scc:  { label: "RM4SCC",   note: "Royal Mail / KIX 4‑state." },
      pharmacode:  { label: "Pharmacode",   note: "One‑track pharma code." },
      pharmacode2:  { label: "Pharmacode 2‑track",   note: "Two‑track pharma code." },
      isbn:  { label: "ISBN",   note: "Books; based on EAN‑13." },
      issn:  { label: "ISSN",   note: "Serials; based on EAN‑13." },
      ismn:  { label: "ISMN",   note: "Music prints; based on EAN‑13." },
},
    labels: {
      gridTitle: "Labels",
      margins: "Margins (mm)",
      gutter: "Gutter (mm)",
      skip: "Skip labels",
      scaleX: "Label scaling (× page)",
      rotateOnSheet: "Rotate on page",
      showGrid: "Show grid lines",
      editMode: "Edit mode",
      freeLayout: "Free layout (any position)",
      snap: "Snap (mm)",
      posMM: "Position (mm)",
      moveAll: "Move ALL by (mm)",
      x: "X",
      y: "Y",
      dX: "ΔX",
      dY: "ΔY",
      editAll: "Edit all",
      lockAspect: "Lock aspect",
      widthShort: "W",
      heightShort: "H",
      count: "Labels",
      perPage: "Per page",
      pages: "Pages",
      zoom: "Zoom",
      print: "Print",
      exportPdf: "Export PDF",
      reset: "Reset settings",
      clearLabels: "Clear labels",
      alignLeft: "Align left",
      alignCenterH: "Align center (H)",
      alignRight: "Align right",
      distributeH: "Distribute horizontally",
      alignTop: "Align top",
      centerV: "Center vertically",
      alignBottom: "Align bottom",
      distributeV: "Distribute vertically",
      centerH: "Center horizontally",
      centerHV: "Center (H+V)",
    },
    gs1: {
      verifyTitle: "GS1 verification (AI)",
      ok: "OK — no issues detected.",
    },
    errors: {
      fallback: "Invalid data for the selected symbology.",
      ean13badlength: "EAN‑13 must be 12 or 13 digits",
      ean8badlength: "EAN‑8 must be 7 or 8 digits",
      upcabadlength: "UPC‑A must be 11 or 12 digits",
      upcebadlength: "UPC‑E must be 6, 7 or 8 digits",
      itf14badlength: "ITF‑14 must be 13 or 14 digits",
      code39badcharacter: "Code 39 contains an invalid character",
      code128badcharacter: "Code 128 contains an invalid character",
      itfbadcharacter: "ITF (Interleaved 2 of 5) accepts digits only",
      badcheckdigit: "Invalid check digit",
      badchecksum: "Invalid checksum",
      toolong: "Too much data",
    }
  }
};

const I18nCtx = createContext({ t:(k)=>k, lang:'pl', setLang:()=>{} });

export function I18nProvider({ children }){
  const [lang, setLang] = useState(()=>{
    try { return localStorage.getItem('rbs_lang') || 'pl'; } catch(_) { return 'pl'; }
  });
  useEffect(()=>{ try{ localStorage.setItem('rbs_lang', lang) }catch(_){ } }, [lang]);
  const t = useMemo(()=>{
    const dict = TRANSLATIONS[lang] || TRANSLATIONS.pl;
    return (key, vars={}) => {
      const segs = key.split('.');
      let cur = dict;
      for (const s of segs){ cur = cur?.[s]; if (cur==null) break; }
      let out = cur ?? key;
      if (typeof out === 'string'){
        Object.entries(vars).forEach(([k,v])=>{ out = out.replace(new RegExp('\\{'+k+'\\}','g'), String(v)); });
      }
      return out;
    };
  }, [lang]);
  const value = useMemo(()=>({ t, lang, setLang }), [t, lang]);
  return <I18nCtx.Provider value={value}>{children}</I18nCtx.Provider>;
}

export function useI18n(){ return useContext(I18nCtx); }
